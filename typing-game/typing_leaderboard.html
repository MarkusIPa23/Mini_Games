<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="../style.css">
<style>
h1 { position: relative; }
button { position: absolute; top: 10px; right: 10px; padding: 8px 16px; background-color: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
button:hover { background-color: #d32f2f; }
#leaderboard ul { padding-left: 20px; list-style: none; }
#leaderboard li { margin-bottom: 5px; }
</style>
</head>
<body>
<h1>Typing Leaderboard</h1>
<button onclick="window.location.href='../index.html'">Back to Menu</button>
<div id="leaderboard"></div>
<script>
window.userId = localStorage.getItem('userId');
window.username = localStorage.getItem('username');
async function loadLeaderboards() {
    let html = "";
    const levels = ["easy", "medium", "hard", "hardcore"];
    for (const level of levels) {
        try {
            const response = await fetch(`../api/get_typing_scores.php?level=${level}`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            html += `<h3>${level.charAt(0).toUpperCase() + level.slice(1)}</h3>`;
            if (data.length === 0) {
                html += `<p>No scores yet</p>`;
            } else {
                html += `<ol>`;
                data.forEach((x, index) => {
                    const isUser = window.username && x.username === window.username;
                    const tag = isUser ? 'strong' : 'span';
                    html += `<li><${tag}>${x.username}: ${x.wpm.toFixed(1)} WPM</${tag}></li>`;
                });
                html += `</ol>`;
            }
        } catch (error) {
            console.error(`Error loading ${level} leaderboard:`, error);
            html += `<h3>${level.charAt(0).toUpperCase() + level.slice(1)}</h3><p>Error loading leaderboard</p>`;
        }
    }
    if (window.userId) {
        try {
            const userRes = await fetch(`../api/get_user_typing_scores.php?user_id=${window.userId}`);
            if (!userRes.ok) throw new Error(`HTTP error! status: ${userRes.status}`);
            const userData = await userRes.json();
            if (userData.status === "success" && userData.scores.length > 0) {
                html += "<h3>Your Best Scores</h3><ul>";
                userData.scores.forEach(s => html += `<li>${s.level.charAt(0).toUpperCase() + s.level.slice(1)}: ${s.wpm.toFixed(1)} WPM</li>`);
                html += "</ul>";
            }
        } catch (error) {
            console.error("Error loading user scores:", error);
        }
    }
    document.getElementById("leaderboard").innerHTML = html;
}
loadLeaderboards();
</script>
</body>
</html>